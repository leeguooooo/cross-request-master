name: Create Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Create Release ZIP
      run: |
        zip -r cross-request-${{ github.ref_name }}.zip . \
          -x "*.git*" \
          -x ".github/*" \
          -x ".DS_Store" \
          -x "CHROME_STORE_GUIDE.md" \
          -x "RELEASE_NOTES.md" \
          -x "*.zip"
    
    - name: Create Release
      uses: ncipollo/release-action@v1
      with:
        artifacts: "cross-request-${{ github.ref_name }}.zip"
        tag: ${{ github.ref_name }}
        name: Release ${{ github.ref_name }}
        body: |
          ## ğŸ› Bug ä¿®å¤
          - ä¿®å¤äº† Chrome back/forward cache é”™è¯¯
          - æ·»åŠ äº†å…¨é¢çš„é”™è¯¯å¤„ç†æœºåˆ¶
          
          ## ğŸ‰ æ–°åŠŸèƒ½  
          - æ–°å¢æ²¹çŒ´è„šæœ¬ç‰ˆæœ¬æ”¯æŒ
          - æä¾›å›¾å½¢åŒ–çš„åŸŸåç®¡ç†ç•Œé¢
          
          ## ğŸ“¦ ä¸‹è½½
          - Chrome æ‰©å±•ï¼šä¸‹è½½ä¸‹æ–¹çš„ ZIP æ–‡ä»¶
          - æ²¹çŒ´è„šæœ¬ï¼š[ç‚¹å‡»å®‰è£…](https://raw.githubusercontent.com/leeguooooo/cross-request-master/main/cross-request.user.js)
        draft: false
        prerelease: false
        token: ${{ secrets.GITHUB_TOKEN }}